<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Study Planner</title>
<style>
body { font-family: Arial; direction: rtl; padding: 20px; background: #f2f2f2; }
input, button { padding: 8px; margin: 5px 0; }
.subject { background: #fff; padding: 10px; margin: 10px 0; border-radius: 5px; }
.chapter { margin-right: 20px; }
.done { color: green; text-decoration: line-through; }
.reminder { font-size: 14px; color: #555; }
</style>
</head>
<body>

<h2>ğŸ“š Ù…Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h2>

<input type="text" id="subjectInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
<button id="addBtn">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>

<div id="subjects"></div>

<hr>
<h3>â° Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h3>
<ul id="reminders"></ul>

<button id="resetBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>

<script>
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
let data = JSON.parse(localStorage.getItem("studyData")) || [];
let remindersData = JSON.parse(localStorage.getItem("reminders")) || [];

// Ø§Ù„Ø¹Ù†Ø§ØµØ±
const subjectInput = document.getElementById("subjectInput");
const subjectsDiv = document.getElementById("subjects");
const remindersUl = document.getElementById("reminders");

// Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©
document.getElementById("addBtn").onclick = () => {
    const name = subjectInput.value.trim();
    if (!name) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹");
    data.push({ name: name, chapters: [] });
    subjectInput.value = "";
    save();
    render();
};

// Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø¨ØªØ±
function addChapter(sIndex) {
    const ch = prompt("Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø¨ØªØ±:");
    if (!ch) return;
    data[sIndex].chapters.push({ name: ch, done: false, finishedAt: null });
    save();
    render();
}

// Ø¥Ù†Ù‡Ø§Ø¡ Ø´Ø§Ø¨ØªØ±
function finishChapter(sIndex, cIndex) {
    const now = new Date();
    const chapter = data[sIndex].chapters[cIndex];
    chapter.done = true;
    chapter.finishedAt = now.toLocaleString();
    createReminders(chapter.name, now);
    save();
    render();
}

// Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø±Ø§Ø¬Ø¹Ø©
function createReminders(name, base) {
    const times = [];
    const sameDay = new Date(base); sameDay.setHours(21,0,0);
    const nextDay = new Date(base); nextDay.setDate(nextDay.getDate()+1); nextDay.setHours(5,0,0);
    const after3 = new Date(base); after3.setDate(after3.getDate()+3); after3.setHours(9,0,0);
    const after7 = new Date(base); after7.setDate(after7.getDate()+7); after7.setHours(9,0,0);
    times.push(sameDay,nextDay,after3,after7);
    times.forEach(t => remindersData.push({ text: name, time: t.toLocaleString() }));
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function save() {
    localStorage.setItem("studyData", JSON.stringify(data));
    localStorage.setItem("reminders", JSON.stringify(remindersData));
}

// Ø¥Ø¹Ø§Ø¯Ø© ÙƒÙ„ Ø´ÙŠØ¡
document.getElementById("resetBtn").onclick = () => {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ØŸ")) {
        localStorage.clear();
        location.reload();
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø´Ø§Ø¨ØªØ±Ø§Øª
function render() {
    subjectsDiv.innerHTML = "";
    data.forEach((s,i) => {
        const div = document.createElement("div");
        div.className = "subject";
        div.innerHTML = `<b>${s.name}</b> <button onclick="addChapter(${i})">+ Chapter</button>`;
        s.chapters.forEach((c,j) => {
            div.innerHTML += `<div class="chapter ${c.done?'done':''}">
                ${c.name} ${c.finishedAt?'âœ” '+c.finishedAt:''}
                ${!c.done?`<button onclick="finishChapter(${i},${j})">âœ”</button>`:''}
            </div>`;
        });
        subjectsDiv.appendChild(div);
    });

    remindersUl.innerHTML = "";
    remindersData.forEach(r => {
        const li = document.createElement("li");
        li.className = "reminder";
        li.textContent = `${r.text} â€” ${r.time}`;
        remindersUl.appendChild(li);
    });
}

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
render();
</script>

</body>
</html>